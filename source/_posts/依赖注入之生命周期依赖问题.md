title: .Net 依赖注入之生命周期依赖问题
author: ismatch
date: 2023-02-02 10:32:41
tags:
---
- 长生命周期的服务不能依赖短生命周期的服务
> 比如服务就依赖不了瞬时（Scope）服务，会报错
> 解决办法是通过注入IServiceScopeFactory服务来创建IServiceScope对象，这样就可以通过IServiceScope来创建短生命周期的服务了
- eg
```
// breadService-瞬时（Scope） DemoBackgroundService-单例（Singleton）
  private readonly BreadService breadService;
 public DemoBackgroundService(ILogger<DemoBackgroundService> logger, IServiceScopeFactory serviceScopeFactory)
        {
            this.logger = logger;
            using (var scope = serviceScopeFactory.CreateScope())
            {
                this.breadService = scope.ServiceProvider.GetRequiredService<BreadService>();
            }
        }
```